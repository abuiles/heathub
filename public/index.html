<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript"
          src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <title>heatbub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body, html {
      margin:0;
      padding:0;
      font-family:Arial;
    }
    #main {
      position:relative;
      width:1020px;
      padding:20px;
      margin:auto;
    }
    #heatmapArea {
      position:relative;
      float:left;
      width:1000px;
      height:600px;
      margin: 0 auto;
    }
  </style>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31699433-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script type="text/javascript" src="https://raw.github.com/pa7/heatmap.js/master/src/heatmap.js"></script>
  <script type="text/javascript" src="https://raw.github.com/pa7/heatmap.js/master/src/heatmap-gmaps.js"></script>
</head>
<body>
  <script>
    var source = new EventSource('/events');

    source.addEventListener('open', function(e) {
      console.log('connection opened');
    }, false);

    source.onmessage = function(e) {
      last = e;
      console.log(e);
    };

    source.addEventListener('push_event', function(e) {
      last = e;
      var data = $.parseJSON(e.data)
      heatmap.addDataPoint(data.lat, data.lng, 1);
    }, false);

    source.addEventListener('error', function(e) {
      if (e.eventPhase == EventSource.CLOSED) {
        console.log('connection closed');
      }
    }, false);

  </script>
<script type="text/javascript">

  var map;
  var heatmap;

  window.onload = function(){

  var myLatlng = new google.maps.LatLng(48.3333, 12.35);

  var myOptions = {
	  zoom: 2,
	  center: myLatlng,
	  mapTypeId: google.maps.MapTypeId.ROADMAP,
	  disableDefaultUI: false,
	  scrollwheel: true,
	  draggable: true,
	  navigationControl: true,
	  mapTypeControl: false,
	  scaleControl: true
  };
  map = new google.maps.Map(document.getElementById("heatmapArea"), myOptions);

  heatmap = new HeatmapOverlay(map, {"radius":20, "visible":true, "opacity":50});
  $("#heatmapArea")[0].style.display = "block";
};

</script>

  <div id="main">
    <div id="heatmapArea">
    </div>
  </div>
</body>
</html>
